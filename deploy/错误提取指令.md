# LIVE_EXEC_ERROR 提取指令

## 1) 直接提取最近一次运行中的 LIVE_EXEC_ERROR（可粘贴）

```bash
cd /opt/pm-shadow/Son-of-weather
python3 - <<'PY'
import json
import glob

files = sorted(glob.glob("reports/live_*.jsonl") + glob.glob("reports/dual_*.jsonl"))
if not files:
    print("no jsonl report found")
    raise SystemExit(0)

latest = files[-1]
print("report:", latest)
found = 0
with open(latest, "r", encoding="utf-8") as f:
    for line in f:
        try:
            x = json.loads(line)
        except Exception:
            continue
        if x.get("type") != "decision":
            continue
        ex = x.get("exec") or {}
        if ex.get("reason") == "LIVE_EXEC_ERROR":
            found += 1
            print("\nLIVE_EXEC_ERROR")
            print("detail =", ex.get("detail"))
            print("action =", x.get("action"))

print("\ncount =", found)
PY
```

## 2) 同时保存到文件（便于回传）

```bash
cd /opt/pm-shadow/Son-of-weather
python3 - <<'PY'
import json
import glob
from datetime import datetime

files = sorted(glob.glob("reports/live_*.jsonl") + glob.glob("reports/dual_*.jsonl"))
if not files:
    print("no jsonl report found")
    raise SystemExit(0)

latest = files[-1]
ts = datetime.utcnow().strftime("%Y%m%d_%H%M%S")
out = f"reports/error_extract_{ts}.txt"

count = 0
with open(latest, "r", encoding="utf-8") as f, open(out, "w", encoding="utf-8") as w:
    w.write(f"report={latest}\n\n")
    for line in f:
        try:
            x = json.loads(line)
        except Exception:
            continue
        if x.get("type") != "decision":
            continue
        ex = x.get("exec") or {}
        if ex.get("reason") == "LIVE_EXEC_ERROR":
            count += 1
            w.write("LIVE_EXEC_ERROR\n")
            w.write(f"detail={ex.get('detail')}\n")
            w.write(f"action={x.get('action')}\n\n")

print("saved:", out)
print("count:", count)
PY
```

## 3) 结果解释

- `detail=...`：具体异常文本（最关键，定位根因看它）
- `action=...`：触发该异常的下单参数（token/side/price/shares/usdc）
- `count=0`：本次报告里没有 `LIVE_EXEC_ERROR`
